// Isiolo City FC Database Schema
generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// ============================================
// AUTHENTICATION & USERS
// ============================================

enum UserRole {
  ADMIN
  MEMBER
  FAN
  COACH
  PLAYER
}

enum MembershipTier {
  FREE
  BRONZE
  SILVER
  GOLD
  PLATINUM
}

model User {
  id              String          @id @default(uuid())
  email           String          @unique
  passwordHash    String
  name            String
  role            UserRole        @default(FAN)
  membershipTier  MembershipTier  @default(FREE)
  avatar          String?
  phone           String?
  dateOfBirth     DateTime?
  nationality     String?
  isActive        Boolean         @default(true)
  emailVerified   Boolean         @default(false)
  createdAt       DateTime        @default(now())
  updatedAt       DateTime        @updatedAt

  // Relations
  articles        Article[]
  orders          Order[]
  sessions        Session[]
  playerProfile   Player?

  @@index([email])
  @@index([role])
  @@map("users")
}

model Session {
  id           String   @id @default(uuid())
  userId       String
  token        String   @unique
  refreshToken String   @unique
  expiresAt    DateTime
  createdAt    DateTime @default(now())

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([token])
  @@map("sessions")
}

// ============================================
// CONTENT MANAGEMENT
// ============================================

enum ContentCategory {
  NEWS
  MATCH_REPORT
  INTERVIEW
  FEATURE
  PRESS_RELEASE
  ANNOUNCEMENT
  PRESEASON
  COACH
  CLUB_UPDATE
  COMMUNITY_OUTREACH
  PLAYER_PROFILE
}

enum ContentStatus {
  DRAFT
  PUBLISHED
  ARCHIVED
}

model Article {
  id                String          @id @default(uuid())
  title             String
  slug              String          @unique
  excerpt           String
  content           String          @db.Text
  category          ContentCategory
  status            ContentStatus   @default(DRAFT)
  authorId          String
  featuredImageUrl  String?
  tags              String[]
  publishedAt       DateTime?
  viewCount         Int             @default(0)
  createdAt         DateTime        @default(now())
  updatedAt         DateTime        @updatedAt

  // Relations
  author User @relation(fields: [authorId], references: [id])

  @@index([slug])
  @@index([authorId])
  @@index([category])
  @@index([publishedAt])
  @@map("articles")
}


// ============================================
// PLAYERS & TEAM
// ============================================

enum Position {
  GOALKEEPER
  DEFENDER
  MIDFIELDER
  FORWARD
}

enum PlayerStatus {
  ACTIVE
  INJURED
  SUSPENDED
  ON_LOAN
  RETIRED
}

model Player {
  id              String        @id @default(uuid())
  userId          String?       @unique
  firstName       String
  lastName        String
  displayName     String
  position        Position
  jerseyNumber    Int
  nationality     String
  dateOfBirth     DateTime
  height          Float?        // in cm
  weight          Float?        // in kg
  preferredFoot   String?       // "Left", "Right", "Both"
  status          PlayerStatus  @default(ACTIVE)
  bio             String?       @db.Text
  joinedDate      DateTime
  contractEndDate DateTime?
  createdAt       DateTime      @default(now())
  updatedAt       DateTime      @updatedAt

  photoUrls       String[]

  // Relations
  user            User?         @relation(fields: [userId], references: [id])
  stats           PlayerStats?
  achievements    Achievement[]
  matches         Match[]       @relation("MatchPlayers")

  @@index([position])
  @@index([status])
  @@map("players")
}

model PlayerStats {
  id              String   @id @default(uuid())
  playerId        String   @unique
  season          String   // e.g., "2024-2025"
  appearances     Int      @default(0)
  goals           Int      @default(0)
  assists         Int      @default(0)
  yellowCards     Int      @default(0)
  redCards        Int      @default(0)
  minutesPlayed   Int      @default(0)
  passAccuracy    Float?   // percentage
  shotsOnTarget   Int      @default(0)
  tackles         Int      @default(0)
  interceptions   Int      @default(0)
  saves           Int      @default(0)  // for goalkeepers
  cleanSheets     Int      @default(0)  // for goalkeepers
  updatedAt       DateTime @updatedAt

  player Player @relation(fields: [playerId], references: [id], onDelete: Cascade)

  @@index([playerId])
  @@index([season])
  @@map("player_stats")
}

model Achievement {
  id          String   @id @default(uuid())
  playerId    String
  title       String
  description String?
  awardedAt   DateTime
  season      String?
  createdAt   DateTime @default(now())

  player Player @relation(fields: [playerId], references: [id], onDelete: Cascade)

  @@index([playerId])
  @@map("achievements")
}

// ============================================
// MATCHES & FIXTURES
// ============================================

enum MatchStatus {
  SCHEDULED
  LIVE
  HALFTIME
  FULLTIME
  POSTPONED
  CANCELLED
}

model Match {
  id              String       @id @default(uuid())
  homeTeamId      String
  awayTeamId      String
  venueId         String
  kickoffTime     DateTime
  competition     String
  season          String
  status          MatchStatus  @default(SCHEDULED)
  homeScore       Int?
  awayScore       Int?
  attendance      Int?
  matchReport     String?      @db.Text
  createdAt       DateTime     @default(now())
  updatedAt       DateTime     @updatedAt

  highlightUrls   String[]

  // Relations
  homeTeam        Team         @relation("HomeMatches", fields: [homeTeamId], references: [id])
  awayTeam        Team         @relation("AwayMatches", fields: [awayTeamId], references: [id])
  venue           Venue        @relation(fields: [venueId], references: [id])
  players         Player[]     @relation("MatchPlayers")
  tickets         Ticket[]

  @@index([kickoffTime])
  @@index([status])
  @@index([season])
  @@map("matches")
}

model Team {
  id           String  @id @default(uuid())
  name         String
  shortName    String
  logo         String?
  country      String
  founded      Int?
  stadium      String?
  website      String?

  homeMatches  Match[] @relation("HomeMatches")
  awayMatches  Match[] @relation("AwayMatches")

  @@map("teams")
}

model Venue {
  id       String  @id @default(uuid())
  name     String
  city     String
  country  String
  capacity Int
  address  String?

  matches  Match[]

  @@map("venues")
}

model Ticket {
  id          String   @id @default(uuid())
  matchId     String
  seatNumber  String
  category    String   // e.g., "VIP", "Regular", "Student"
  price       Float
  isPurchased Boolean  @default(false)
  purchasedAt DateTime?
  createdAt   DateTime @default(now())

  match Match @relation(fields: [matchId], references: [id], onDelete: Cascade)

  @@index([matchId])
  @@index([isPurchased])
  @@map("tickets")
}

// ============================================
// FOUNDATION & EDUCATION
// ============================================

enum ProgramType {
  YOUTH_ACADEMY
  TRAINING_CAMP
  CLINIC
  SCHOLARSHIP
  COMMUNITY_OUTREACH
  COACHING_COURSE
}

model FoundationProgram {
  id          String      @id @default(uuid())
  name        String
  description String      @db.Text
  type        ProgramType
  startDate   DateTime
  endDate     DateTime?
  location    String
  capacity    Int
  ageGroup    String?     // e.g., "U-13", "U-17", "All ages"
  price       Float?
  isActive    Boolean     @default(true)
  createdAt   DateTime    @default(now())
  updatedAt   DateTime    @updatedAt

  enrollments Enrollment[]

  @@index([type])
  @@index([isActive])
  @@map("foundation_programs")
}

model Enrollment {
  id         String             @id @default(uuid())
  programId  String
  studentName String
  studentAge Int
  guardianName String
  guardianEmail String
  guardianPhone String
  status     String             @default("PENDING") // PENDING, APPROVED, REJECTED
  enrolledAt DateTime           @default(now())

  program    FoundationProgram  @relation(fields: [programId], references: [id], onDelete: Cascade)

  @@index([programId])
  @@index([guardianEmail])
  @@map("enrollments")
}

// ============================================
// SHOP & E-COMMERCE
// ============================================

enum ProductCategory {
  JERSEYS
  TRAINING_GEAR
  ACCESSORIES
  COLLECTIBLES
  KIDS
}

model Product {
  id          String          @id @default(uuid())
  name        String
  slug        String          @unique
  description String          @db.Text
  price       Float
  comparePrice Float?         // Original price if on sale
  category    ProductCategory
  stock       Int             @default(0)
  sku         String          @unique
  featured    Boolean         @default(false)
  isActive    Boolean         @default(true)
  sizes       String[]        // ["S", "M", "L", "XL"]
  colors      String[]        // ["Red", "Blue", "White"]
  createdAt   DateTime        @default(now())
  updatedAt   DateTime        @updatedAt

  imageUrls   String[]

  // Relations
  orderItems  OrderItem[]

  @@index([slug])
  @@index([category])
  @@index([featured])
  @@map("products")
}

enum OrderStatus {
  PENDING
  PROCESSING
  SHIPPED
  DELIVERED
  CANCELLED
  REFUNDED
}

model Order {
  id               String      @id @default(uuid())
  userId           String
  orderNumber      String      @unique
  status           OrderStatus @default(PENDING)
  totalAmount      Float
  shippingAddress  String      @db.Text
  paymentMethod    String
  paymentStatus    String      @default("PENDING")
  transactionId    String?
  notes            String?
  createdAt        DateTime    @default(now())
  updatedAt        DateTime    @updatedAt

  // Relations
  user       User        @relation(fields: [userId], references: [id])
  items      OrderItem[]

  @@index([userId])
  @@index([orderNumber])
  @@index([status])
  @@map("orders")
}

model OrderItem {
  id         String   @id @default(uuid())
  orderId    String
  productId  String
  quantity   Int
  price      Float    // Price at time of order
  size       String?
  color      String?
  createdAt  DateTime @default(now())

  order   Order   @relation(fields: [orderId], references: [id], onDelete: Cascade)
  product Product @relation(fields: [productId], references: [id])

  @@index([orderId])
  @@index([productId])
  @@map("order_items")
}

// ============================================
// SPONSORS & PARTNERSHIPS
// ============================================

enum SponsorTier {
  TITLE
  PLATINUM
  GOLD
  SILVER
  BRONZE
  PARTNER
}

model Sponsor {
  id          String      @id @default(uuid())
  name        String
  logo        String
  website     String?
  tier        SponsorTier
  description String?     @db.Text
  startDate   DateTime
  endDate     DateTime?
  isActive    Boolean     @default(true)
  displayOrder Int        @default(0)
  createdAt   DateTime    @default(now())
  updatedAt   DateTime    @updatedAt

  @@index([tier])
  @@index([isActive])
  @@index([displayOrder])
  @@map("sponsors")
}

// ============================================
// NEWSLETTER & COMMUNICATIONS
// ============================================

model Newsletter {
  id          String   @id @default(uuid())
  email       String   @unique
  isActive    Boolean  @default(true)
  subscribedAt DateTime @default(now())

  @@index([email])
  @@map("newsletter_subscribers")
}
